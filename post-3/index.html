<!DOCTYPE html><html lang="en"> <head><!-- favicon --><link rel="shortcut icon" href="/images/favicon.png"><!-- theme meta --><meta name="theme-name" content="bookworm-light-astro"><meta name="msapplication-TileColor" content="#000000"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"><meta name="generator" content="Astro v5.8.0"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- google font css --><style>@font-face {unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;font-weight: 400;font-style: normal;font-family: 'Nunito';font-display: swap;src: url(https://fonts.gstatic.com/s/nunito/v32/XRXV3I6Li01BKofIOOaBTMnFcQIG.woff2)} @font-face {unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;font-weight: 400;font-style: normal;font-family: 'Nunito';font-display: swap;src: url(https://fonts.gstatic.com/s/nunito/v32/XRXV3I6Li01BKofIMeaBTMnFcQIG.woff2)} @font-face {unicode-range: U+0102-0103, U+0110-0111, U+0128-0129, U+0168-0169, U+01A0-01A1, U+01AF-01B0, U+0300-0301, U+0303-0304, U+0308-0309, U+0323, U+0329, U+1EA0-1EF9, U+20AB;font-weight: 400;font-style: normal;font-family: 'Nunito';font-display: swap;src: url(https://fonts.gstatic.com/s/nunito/v32/XRXV3I6Li01BKofIOuaBTMnFcQIG.woff2)} @font-face {unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;font-weight: 400;font-style: normal;font-family: 'Nunito';font-display: swap;src: url(https://fonts.gstatic.com/s/nunito/v32/XRXV3I6Li01BKofIO-aBTMnFcQIG.woff2)} @font-face {unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;font-weight: 400;font-style: normal;font-family: 'Nunito';font-display: swap;src: url(https://fonts.gstatic.com/s/nunito/v32/XRXV3I6Li01BKofINeaBTMnFcQ.woff2)} @font-face {unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;font-weight: 600;font-style: normal;font-family: 'Nunito';font-display: swap;src: url(https://fonts.gstatic.com/s/nunito/v32/XRXV3I6Li01BKofIOOaBTMnFcQIG.woff2)} @font-face {unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;font-weight: 600;font-style: normal;font-family: 'Nunito';font-display: swap;src: url(https://fonts.gstatic.com/s/nunito/v32/XRXV3I6Li01BKofIMeaBTMnFcQIG.woff2)} @font-face {unicode-range: U+0102-0103, U+0110-0111, U+0128-0129, U+0168-0169, U+01A0-01A1, U+01AF-01B0, U+0300-0301, U+0303-0304, U+0308-0309, U+0323, U+0329, U+1EA0-1EF9, U+20AB;font-weight: 600;font-style: normal;font-family: 'Nunito';font-display: swap;src: url(https://fonts.gstatic.com/s/nunito/v32/XRXV3I6Li01BKofIOuaBTMnFcQIG.woff2)} @font-face {unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;font-weight: 600;font-style: normal;font-family: 'Nunito';font-display: swap;src: url(https://fonts.gstatic.com/s/nunito/v32/XRXV3I6Li01BKofIO-aBTMnFcQIG.woff2)} @font-face {unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;font-weight: 600;font-style: normal;font-family: 'Nunito';font-display: swap;src: url(https://fonts.gstatic.com/s/nunito/v32/XRXV3I6Li01BKofINeaBTMnFcQ.woff2)} @font-face {unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;font-weight: 700;font-style: normal;font-family: 'Nunito';font-display: swap;src: url(https://fonts.gstatic.com/s/nunito/v32/XRXV3I6Li01BKofIOOaBTMnFcQIG.woff2)} @font-face {unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;font-weight: 700;font-style: normal;font-family: 'Nunito';font-display: swap;src: url(https://fonts.gstatic.com/s/nunito/v32/XRXV3I6Li01BKofIMeaBTMnFcQIG.woff2)} @font-face {unicode-range: U+0102-0103, U+0110-0111, U+0128-0129, U+0168-0169, U+01A0-01A1, U+01AF-01B0, U+0300-0301, U+0303-0304, U+0308-0309, U+0323, U+0329, U+1EA0-1EF9, U+20AB;font-weight: 700;font-style: normal;font-family: 'Nunito';font-display: swap;src: url(https://fonts.gstatic.com/s/nunito/v32/XRXV3I6Li01BKofIOuaBTMnFcQIG.woff2)} @font-face {unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;font-weight: 700;font-style: normal;font-family: 'Nunito';font-display: swap;src: url(https://fonts.gstatic.com/s/nunito/v32/XRXV3I6Li01BKofIO-aBTMnFcQIG.woff2)} @font-face {unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;font-weight: 700;font-style: normal;font-family: 'Nunito';font-display: swap;src: url(https://fonts.gstatic.com/s/nunito/v32/XRXV3I6Li01BKofINeaBTMnFcQ.woff2)} @font-face {unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;font-weight: 800;font-style: normal;font-family: 'Nunito';font-display: swap;src: url(https://fonts.gstatic.com/s/nunito/v32/XRXV3I6Li01BKofIOOaBTMnFcQIG.woff2)} @font-face {unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;font-weight: 800;font-style: normal;font-family: 'Nunito';font-display: swap;src: url(https://fonts.gstatic.com/s/nunito/v32/XRXV3I6Li01BKofIMeaBTMnFcQIG.woff2)} @font-face {unicode-range: U+0102-0103, U+0110-0111, U+0128-0129, U+0168-0169, U+01A0-01A1, U+01AF-01B0, U+0300-0301, U+0303-0304, U+0308-0309, U+0323, U+0329, U+1EA0-1EF9, U+20AB;font-weight: 800;font-style: normal;font-family: 'Nunito';font-display: swap;src: url(https://fonts.gstatic.com/s/nunito/v32/XRXV3I6Li01BKofIOuaBTMnFcQIG.woff2)} @font-face {unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;font-weight: 800;font-style: normal;font-family: 'Nunito';font-display: swap;src: url(https://fonts.gstatic.com/s/nunito/v32/XRXV3I6Li01BKofIO-aBTMnFcQIG.woff2)} @font-face {unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;font-weight: 800;font-style: normal;font-family: 'Nunito';font-display: swap;src: url(https://fonts.gstatic.com/s/nunito/v32/XRXV3I6Li01BKofINeaBTMnFcQ.woff2)} @font-face {unicode-range: U+0102-0103, U+0110-0111, U+0128-0129, U+0168-0169, U+01A0-01A1, U+01AF-01B0, U+0300-0301, U+0303-0304, U+0308-0309, U+0323, U+0329, U+1EA0-1EF9, U+20AB;font-weight: 500;font-style: normal;font-family: 'Quicksand';font-display: swap;src: url(https://fonts.gstatic.com/s/quicksand/v37/6xKtdSZaM9iE8KbpRA_hJFQNYuDyP7bh.woff2)} @font-face {unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;font-weight: 500;font-style: normal;font-family: 'Quicksand';font-display: swap;src: url(https://fonts.gstatic.com/s/quicksand/v37/6xKtdSZaM9iE8KbpRA_hJVQNYuDyP7bh.woff2)} @font-face {unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;font-weight: 500;font-style: normal;font-family: 'Quicksand';font-display: swap;src: url(https://fonts.gstatic.com/s/quicksand/v37/6xKtdSZaM9iE8KbpRA_hK1QNYuDyPw.woff2)} @font-face {unicode-range: U+0102-0103, U+0110-0111, U+0128-0129, U+0168-0169, U+01A0-01A1, U+01AF-01B0, U+0300-0301, U+0303-0304, U+0308-0309, U+0323, U+0329, U+1EA0-1EF9, U+20AB;font-weight: 600;font-style: normal;font-family: 'Quicksand';font-display: swap;src: url(https://fonts.gstatic.com/s/quicksand/v37/6xKtdSZaM9iE8KbpRA_hJFQNYuDyP7bh.woff2)} @font-face {unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;font-weight: 600;font-style: normal;font-family: 'Quicksand';font-display: swap;src: url(https://fonts.gstatic.com/s/quicksand/v37/6xKtdSZaM9iE8KbpRA_hJVQNYuDyP7bh.woff2)} @font-face {unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;font-weight: 600;font-style: normal;font-family: 'Quicksand';font-display: swap;src: url(https://fonts.gstatic.com/s/quicksand/v37/6xKtdSZaM9iE8KbpRA_hK1QNYuDyPw.woff2)} :root{ --font-primary: 'Nunito', '_font_fallback_923254088253', sans-serif; } @font-face { font-family: '_font_fallback_923254088253'; size-adjust: 100.00%; src: local('Arial'); ascent-override: 101.10%; descent-override: 35.30%; line-gap-override: 0.00%; } :root{ --font-secondary: 'Quicksand', '_font_fallback_222664088070', sans-serif; } @font-face { font-family: '_font_fallback_222664088070'; size-adjust: 103.88%; src: local('Arial'); ascent-override: 96.26%; descent-override: 24.07%; line-gap-override: 0.00%; }</style><!-- responsive meta --><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><!-- title --><title>
      Astro 部署到 GitHub Pages

    </title><!-- canonical url --><!-- noindex robots --><!-- meta-description --><meta name="description" content="记录我如何把 Astro 博客从私有源码仓库自动构建，并部署到公共仓库 why152.github.io 上。
"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.CtSceO8m.js"></script><!-- author from config.json --><meta name="author" content="Themefisher"><!-- og-title --><meta property="og:title" content="Astro 部署到 GitHub Pages
"><!-- og-description --><meta property="og:description" content="记录我如何把 Astro 博客从私有源码仓库自动构建，并部署到公共仓库 why152.github.io 上。
"><meta property="og:type" content="website"><meta property="og:url" content="https://bookworm-light-astro.vercel.app/post-3"><!-- twitter-title --><meta name="twitter:title" content="Astro 部署到 GitHub Pages
"><!-- twitter-description --><meta name="twitter:description" content="记录我如何把 Astro 博客从私有源码仓库自动构建，并部署到公共仓库 why152.github.io 上。
"><!-- og-image --><meta property="og:image" content="https://bookworm-light-astro.vercel.app/images/posts/post-2.png"><!-- twitter-image --><meta name="twitter:image" content="https://bookworm-light-astro.vercel.app/images/posts/post-2.png"><meta name="twitter:card" content="summary_large_image"><link rel="stylesheet" href="/_astro/_regular_.BpQPJ342.css"></head> <body>  <header class="header pt-8 pb-6 shadow-sm shadow-[rgba(47,74,77,0.05)] bg-body/95 backdrop-blur"> <nav class="navbar container"> <!-- logo --> <div class="order-0"> <a href="/" class="navbar-brand"> <img src="/images/logo.png" alt="Bookworm Light" style="height:60px;width:197px" width="394" height="120" loading="lazy" decoding="async"> </a> </div> <!-- navbar toggler --> <input id="nav-toggle" type="checkbox" class="hidden"> <label id="show-button" for="nav-toggle" class="order-2 flex cursor-pointer items-center text-dark transition duration-300 hover:text-accent md:order-1 md:hidden"> <svg class="h-6 fill-current" viewBox="0 0 20 20"> <title>Menu Open</title> <path d="M0 3h20v2H0V3z m0 6h20v2H0V9z m0 6h20v2H0V0z"></path> </svg> </label> <label id="hide-button" for="nav-toggle" class="order-2 hidden cursor-pointer items-center text-dark transition duration-300 hover:text-accent md:order-1"> <svg class="h-6 fill-current" viewBox="0 0 20 20"> <title>Menu Close</title> <polygon points="11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2" transform="rotate(45 10 10)"></polygon> </svg> </label> <!-- /navbar toggler --> <ul id="nav-menu" class="navbar-nav order-3 hidden w-full md:order-1 md:flex md:w-auto"> <li class="nav-item"> <a href="/" class="nav-link block"> Home </a> </li><li class="nav-item"> <a href="/about" class="nav-link block"> About </a> </li><li class="nav-item"> <a href="/authors" class="nav-link block"> Authors </a> </li><li class="nav-item nav-dropdown group relative cursor-pointer"> <span class="nav-link inline-flex items-center"> Pages <svg class="h-5 w-5 fill-current" viewBox="0 0 20 20"> <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"></path> </svg> </span> <ul class="nav-dropdown-list hidden group-hover:block md:invisible md:absolute md:block md:opacity-0 md:group-hover:visible md:group-hover:opacity-100"> <li class="nav-dropdown-item"> <a href="/categories" class="nav-dropdown-link"> Categories </a> </li><li class="nav-dropdown-item"> <a href="/tags" class="nav-dropdown-link"> Tags </a> </li><li class="nav-dropdown-item"> <a href="/privacy-policy" class="nav-dropdown-link"> Privacy Policy </a> </li> </ul> </li> </ul> <div class="order-1 ml-auto flex md:order-2 md:ml-0"> <a class="mr-4 inline-flex h-10 w-10 items-center justify-center rounded-full border border-transparent bg-light/80 text-xl text-primary transition duration-300 hover:border-accent hover:bg-accent hover:text-white md:mr-0" href="/search" title="seach" aria-label="seach"> <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M456.69 421.39 362.6 327.3a173.81 173.81 0 0 0 34.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 0 0 327.3 362.6l94.09 94.09a25 25 0 0 0 35.3-35.3zM97.92 222.72a124.8 124.8 0 1 1 124.8 124.8 124.95 124.95 0 0 1-124.8-124.8z"></path></svg> </a> </div> </nav> </header> <main id="main-content" class="min-h-[60vh]"> <section class="section"> <div class="container"> <article class="row justify-center"> <div class="md:col-10 text-center"> <h1 class="h2">测试post</h1> <ul class="mt-4 flex flex-wrap items-center justify-center text-text"> <li class="mx-3"> <a href="/authors/why" class="flex items-center font-medium text-dark transition duration-300 hover:text-accent"> <img src="/images/authors/Why.jpg" alt="Why" width="50" height="50" loading="lazy" decoding="async" class="mr-2 h-6 w-6 rounded-full"> <span>Why</span> </a> </li> <li class="mx-3 flex items-center flex-wrap font-medium"> <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="mr-1 h-5 w-5 text-primary" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M19 4h-3V2h-2v2h-4V2H8v2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2V6c0-1.103-.897-2-2-2zM5 20V7h14V6l.002 14H5z"></path><path d="m15.628 12.183-1.8-1.799 1.37-1.371 1.8 1.799zm-7.623 4.018V18h1.799l4.976-4.97-1.799-1.799z"></path></svg> 27 Sep, 2025 </li> <li class="mx-3 flex items-center flex-wrap"> <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="mr-1 h-[18px] w-[18px] text-primary" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M10 3H4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1zM9 9H5V5h4v4zm11 4h-6a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-6a1 1 0 0 0-1-1zm-1 6h-4v-4h4v4zM17 3c-2.206 0-4 1.794-4 4s1.794 4 4 4 4-1.794 4-4-1.794-4-4-4zm0 6c-1.103 0-2-.897-2-2s.897-2 2-2 2 .897 2 2-.897 2-2 2zM7 13c-2.206 0-4 1.794-4 4s1.794 4 4 4 4-1.794 4-4-1.794-4-4-4zm0 6c-1.103 0-2-.897-2-2s.897-2 2-2 2 .897 2 2-.897 2-2 2z"></path></svg> <ul class="flex flex-wrap gap-2"> <li> <a href="/categories/技术" class="category-badge"> 技术 </a> </li><li> <a href="/categories/博客" class="category-badge"> 博客 </a> </li> </ul> </li> </ul> </div> <div class="col-12 mt-8 mb-2"> <img src="/images/posts/post-2.png" alt="测试post" width="1000" height="500" loading="lazy" decoding="async" class="rounded-lg"> </div> <div class="md:col-10"> <div class="content mb-16 text-left"> <p>最近折腾了一下，把用 <strong>Astro</strong> 构建的个人博客部署到了 GitHub Pages。因为源码库是 <strong>私有的</strong>，而 GitHub Pages 需要 <strong>公共仓库（why152.github.io）</strong> 来托管，所以需要用 GitHub Actions 跨仓库推送构建产物。</p>
<p>这里记录一下全过程，方便以后回顾。</p>
<hr>
<h2 id="部署整体思路">部署整体思路</h2>
<ol>
<li><strong>私有仓库</strong> 存放源码（Astro 项目）。</li>
<li>每次 push 到 main 分支时，用 GitHub Actions 自动执行：
<ul>
<li>安装依赖</li>
<li>构建 Astro（生成 <code>dist/</code>）</li>
<li>添加 <code>.nojekyll</code> 文件（避免 <code>_astro/</code> 目录被忽略）</li>
<li>推送 <code>dist/</code> 到 <strong>公共仓库 <code>why152/why152.github.io</code></strong> 的 main 分支</li>
</ul>
</li>
<li>GitHub Pages 从 <code>why152.github.io/main</code> 直接发布站点 → <code>https://why152.github.io</code>。</li>
</ol>
<p>这样就实现了“私有源码 → 自动构建 → 公共仓库 → GitHub Pages”的完整流水线。</p>
<hr>
<h2 id="遇到的问题与解决办法">遇到的问题与解决办法</h2>
<h3 id="1-跨仓库推送权限">1. 跨仓库推送权限</h3>
<p>默认的 <code>GITHUB_TOKEN</code> 只能推送到当前仓库，不能写入其他仓库。<br>
解决办法是创建一个 <strong>Fine-grained Personal Access Token (PAT)</strong>，设置：</p>
<ul>
<li><strong>Repository access</strong>: 只选择 <code>why152/why152.github.io</code></li>
<li><strong>Permissions</strong>: <code>Contents: Read &#x26; Write</code>，<code>Metadata: Read-only</code></li>
<li>存到私有源码仓库的 <strong>Actions Secrets</strong>（名字设为 <code>GH_PAT</code>）</li>
</ul>
<p>这样 workflow 就能跨仓库推送构建产物了。</p>
<hr>
<h3 id="2-nojekyll-文件">2. <code>.nojekyll</code> 文件</h3>
<p>Astro 构建产物里会有 <code>_astro/</code> 文件夹。<br>
但 GitHub Pages 默认用 Jekyll，会忽略掉以 <code>_</code> 开头的目录。</p>
<p>解决办法：在 workflow 里自动生成 <code>.nojekyll</code> 文件：</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#ABB2BF">- </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Add .nojekyll</span></span>
<span class="line"><span style="color:#E06C75">  run</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">echo "" > ./dist/.nojekyll</span></span></code></pre>
<p>这样 <code>_astro/</code> 文件夹就能正确发布。<br>
相比把 <code>.nojekyll</code> 放到源码的 <code>public/</code> 目录，我更喜欢这种方式：<strong>保持源码干净，部署时再自动加</strong>。</p>
<hr>
<h3 id="3-github-自动生成的-staticyml">3. GitHub 自动生成的 <code>static.yml</code></h3>
<p>在 <code>why152.github.io</code> 仓库里，GitHub 会自动生成一个 <code>static.yml</code> workflow：</p>
<ul>
<li>逻辑是：把整个仓库内容打包成 artifact，再用 <code>deploy-pages</code> 发布。</li>
<li>适合 <strong>源码仓库</strong>（例如 Jekyll 博客）。</li>
</ul>
<p>我的情况是：<code>why152.github.io</code> 存放的是 <strong>纯静态文件</strong>，而且我加了 <code>.nojekyll</code>，GitHub Pages 就不会再用 Jekyll，而是走 <strong>纯静态托管</strong> 模式。</p>
<p>这时候有两种选择：</p>
<ul>
<li><strong>Branch 模式</strong>：在 Pages 设置里选择 <strong>Branch → main → root</strong>，直接把仓库内容上线。最轻量。</li>
<li><strong>Actions 模式</strong>：保留 <code>static.yml</code>，让 GitHub Actions 把仓库内容打包再发布。更通用，也更贴近 GitHub 官方推荐的方式。</li>
</ul>
<p>两者结果一样，只是实现路径不同。</p>
<hr>
<h2 id="最终的私有仓库-workflow">最终的私有仓库 workflow</h2>
<p>这是我在私有仓库里用的 <code>.github/workflows/deploy-to-user-site.yml</code>：</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Build &#x26; Deploy Astro to why152.github.io</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D19A66">on</span><span style="color:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75">  push</span><span style="color:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75">    branches</span><span style="color:#ABB2BF">: [</span><span style="color:#98C379">"main"</span><span style="color:#ABB2BF">]</span></span>
<span class="line"><span style="color:#E06C75">  workflow_dispatch</span><span style="color:#ABB2BF">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">permissions</span><span style="color:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75">  contents</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">read</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">concurrency</span><span style="color:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75">  group</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">deploy-to-user-site</span></span>
<span class="line"><span style="color:#E06C75">  cancel-in-progress</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">env</span><span style="color:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75">  TARGET_REPO</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">why152/why152.github.io</span></span>
<span class="line"><span style="color:#E06C75">  TARGET_BRANCH</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">main</span></span>
<span class="line"><span style="color:#E06C75">  PUBLISH_DIR</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">dist</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">jobs</span><span style="color:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75">  deploy</span><span style="color:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75">    runs-on</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">ubuntu-latest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">    steps</span><span style="color:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF">      - </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Checkout source</span></span>
<span class="line"><span style="color:#E06C75">        uses</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">actions/checkout@v4</span></span>
<span class="line"><span style="color:#E06C75">        with</span><span style="color:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75">          fetch-depth</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">      - </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Setup Node</span></span>
<span class="line"><span style="color:#E06C75">        uses</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">actions/setup-node@v4</span></span>
<span class="line"><span style="color:#E06C75">        with</span><span style="color:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75">          node-version</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"20"</span></span>
<span class="line"><span style="color:#E06C75">          cache</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"npm"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">      - </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Install dependencies</span></span>
<span class="line"><span style="color:#E06C75">        run</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">npm ci</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">      - </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Build</span></span>
<span class="line"><span style="color:#E06C75">        run</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">npm run build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">      - </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Add .nojekyll</span></span>
<span class="line"><span style="color:#E06C75">        run</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">echo "" > ./${{ env.PUBLISH_DIR }}/.nojekyll</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">      - </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Deploy to why152.github.io</span></span>
<span class="line"><span style="color:#E06C75">        uses</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">peaceiris/actions-gh-pages@v4</span></span>
<span class="line"><span style="color:#E06C75">        with</span><span style="color:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75">          personal_token</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">${{ secrets.GH_PAT }}</span></span>
<span class="line"><span style="color:#E06C75">          external_repository</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">${{ env.TARGET_REPO }}</span></span>
<span class="line"><span style="color:#E06C75">          publish_branch</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">${{ env.TARGET_BRANCH }}</span></span>
<span class="line"><span style="color:#E06C75">          publish_dir</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">./${{ env.PUBLISH_DIR }}</span></span></code></pre>
<p>这个流程会：</p>
<ol>
<li>检出源码</li>
<li>安装依赖并构建 Astro</li>
<li>自动生成 <code>.nojekyll</code></li>
<li>把 <code>dist/</code> 推送到 <code>why152.github.io/main</code></li>
</ol>
<hr>
<h2 id="学到的区别">学到的区别</h2>
<ul>
<li>
<p><strong>GitHub 自动生成的 workflow (<code>static.yml</code>)</strong><br>
用于源码仓库（适合 Jekyll / 未构建的前端项目），会自动打包并发布。</p>
</li>
<li>
<p><strong>自定义 workflow</strong><br>
用于“构建产物仓库”场景（比如 Astro/Vite/React 项目构建结果），直接把构建好的静态文件推送到公共仓库。</p>
</li>
<li>
<p><strong>两者结合</strong>：只要有 <code>.nojekyll</code>，GitHub Pages 就会走纯静态托管；是否用 <code>static.yml</code>，取决于你想要的是 <strong>轻量的 Branch 模式</strong> 还是 <strong>更通用的 Actions 模式</strong>。</p>
</li>
</ul>
<p>理解这几点，是这次部署过程中最大的收获。</p>
<hr>
<h2 id="最终效果">最终效果</h2>
<ul>
<li>私有仓库：只存源码，不带多余文件</li>
<li>公共仓库：只存构建产物（含 <code>.nojekyll</code>），可选择 Branch 或 Actions 模式托管</li>
<li>访问地址：<a href="https://why152.github.io">https://why152.github.io</a> 🚀</li>
</ul>
<p>整个流程简洁又高效，算是比较理想的方案。</p> </div> <div class="flex flex-wrap items-center justify-start"> <ul class="mr-4 mb-4 flex flex-wrap gap-3"> <li class="inline-block"> <a href="/tags/astro" class="block rounded-full bg-light px-4 py-2 text-sm font-semibold text-dark transition duration-300 hover:bg-accent/20 hover:text-accent">
#Astro </a> </li><li class="inline-block"> <a href="/tags/github-pages" class="block rounded-full bg-light px-4 py-2 text-sm font-semibold text-dark transition duration-300 hover:bg-accent/20 hover:text-accent">
#GitHub Pages </a> </li><li class="inline-block"> <a href="/tags/部署" class="block rounded-full bg-light px-4 py-2 text-sm font-semibold text-dark transition duration-300 hover:bg-accent/20 hover:text-accent">
#部署 </a> </li> </ul> </div> </div> </article> </div> </section> <!-- similar posts -->  </main> <footer class="section bg-dark"> <div class="container text-center">  <ul class="mb-8 space-x-4"> <li class="inline-block"> <a href="/about" class="p-4 text-white/75 hover:text-white transition-all"> About </a> </li><li class="inline-block"> <a href="/authors" class="p-4 text-white/75 hover:text-white transition-all"> Authors </a> </li><li class="inline-block"> <a href="/elements" class="p-4 text-white/75 hover:text-white transition-all"> Elements </a> </li><li class="inline-block"> <a href="/privacy-policy" class="p-4 text-white/75 hover:text-white transition-all"> Privacy Policy </a> </li> </ul>  <ul class="social-icons mb-8">  <li class="inline-block"> <a aria-label="twitter" href="https://x.com/Tcindoorsman" target="_blank" rel="noopener noreferrer nofollow"> <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M496 109.5a201.8 201.8 0 0 1-56.55 15.3 97.51 97.51 0 0 0 43.33-53.6 197.74 197.74 0 0 1-62.56 23.5A99.14 99.14 0 0 0 348.31 64c-54.42 0-98.46 43.4-98.46 96.9a93.21 93.21 0 0 0 2.54 22.1 280.7 280.7 0 0 1-203-101.3A95.69 95.69 0 0 0 36 130.4c0 33.6 17.53 63.3 44 80.7A97.5 97.5 0 0 1 35.22 199v1.2c0 47 34 86.1 79 95a100.76 100.76 0 0 1-25.94 3.4 94.38 94.38 0 0 1-18.51-1.8c12.51 38.5 48.92 66.5 92.05 67.3A199.59 199.59 0 0 1 39.5 405.6a203 203 0 0 1-23.5-1.4A278.68 278.68 0 0 0 166.74 448c181.36 0 280.44-147.7 280.44-275.8 0-4.2-.11-8.4-.31-12.5A198.48 198.48 0 0 0 496 109.5z"></path></svg> </a> </li>  <li class="inline-block"> <a aria-label="instagram" href="https://www.instagram.com/hy_wang152/" target="_blank" rel="noopener noreferrer nofollow"> <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M349.33 69.33a93.62 93.62 0 0 1 93.34 93.34v186.66a93.62 93.62 0 0 1-93.34 93.34H162.67a93.62 93.62 0 0 1-93.34-93.34V162.67a93.62 93.62 0 0 1 93.34-93.34h186.66m0-37.33H162.67C90.8 32 32 90.8 32 162.67v186.66C32 421.2 90.8 480 162.67 480h186.66C421.2 480 480 421.2 480 349.33V162.67C480 90.8 421.2 32 349.33 32z"></path><path d="M377.33 162.67a28 28 0 1 1 28-28 27.94 27.94 0 0 1-28 28zM256 181.33A74.67 74.67 0 1 1 181.33 256 74.75 74.75 0 0 1 256 181.33m0-37.33a112 112 0 1 0 112 112 112 112 0 0 0-112-112z"></path></svg> </a> </li>                     <li class="inline-block"> <a aria-label="xiaohongshu" href="https://www.xiaohongshu.com/user/profile/62a5a9ef000000001b029120" target="_blank" rel="noopener noreferrer nofollow"> <svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M22.405 9.879c.002.016.01.02.07.019h.725a.797.797 0 0 0 .78-.972.794.794 0 0 0-.884-.618.795.795 0 0 0-.692.794c0 .101-.002.666.001.777zm-11.509 4.808c-.203.001-1.353.004-1.685.003a2.528 2.528 0 0 1-.766-.126.025.025 0 0 0-.03.014L7.7 16.127a.025.025 0 0 0 .01.032c.111.06.336.124.495.124.66.01 1.32.002 1.981 0 .01 0 .02-.006.023-.015l.712-1.545a.025.025 0 0 0-.024-.036zM.477 9.91c-.071 0-.076.002-.076.01a.834.834 0 0 0-.01.08c-.027.397-.038.495-.234 3.06-.012.24-.034.389-.135.607-.026.057-.033.042.003.112.046.092.681 1.523.787 1.74.008.015.011.02.017.02.008 0 .033-.026.047-.044.147-.187.268-.391.371-.606.306-.635.44-1.325.486-1.706.014-.11.021-.22.03-.33l.204-2.616.022-.293c.003-.029 0-.033-.03-.034zm7.203 3.757a1.427 1.427 0 0 1-.135-.607c-.004-.084-.031-.39-.235-3.06a.443.443 0 0 0-.01-.082c-.004-.011-.052-.008-.076-.008h-1.48c-.03.001-.034.005-.03.034l.021.293c.076.982.153 1.964.233 2.946.05.4.186 1.085.487 1.706.103.215.223.419.37.606.015.018.037.051.048.049.02-.003.742-1.642.804-1.765.036-.07.03-.055.003-.112zm3.861-.913h-.872a.126.126 0 0 1-.116-.178l1.178-2.625a.025.025 0 0 0-.023-.035l-1.318-.003a.148.148 0 0 1-.135-.21l.876-1.954a.025.025 0 0 0-.023-.035h-1.56c-.01 0-.02.006-.024.015l-.926 2.068c-.085.169-.314.634-.399.938a.534.534 0 0 0-.02.191.46.46 0 0 0 .23.378.981.981 0 0 0 .46.119h.59c.041 0-.688 1.482-.834 1.972a.53.53 0 0 0-.023.172.465.465 0 0 0 .23.398c.15.092.342.12.475.12l1.66-.001c.01 0 .02-.006.023-.015l.575-1.28a.025.025 0 0 0-.024-.035zm-6.93-4.937H3.1a.032.032 0 0 0-.034.033c0 1.048-.01 2.795-.01 6.829 0 .288-.269.262-.28.262h-.74c-.04.001-.044.004-.04.047.001.037.465 1.064.555 1.263.01.02.03.033.051.033.157.003.767.009.938-.014.153-.02.3-.06.438-.132.3-.156.49-.419.595-.765.052-.172.075-.353.075-.533.002-2.33 0-4.66-.007-6.991a.032.032 0 0 0-.032-.032zm11.784 6.896c0-.014-.01-.021-.024-.022h-1.465c-.048-.001-.049-.002-.05-.049v-4.66c0-.072-.005-.07.07-.07h.863c.08 0 .075.004.075-.074V8.393c0-.082.006-.076-.08-.076h-3.5c-.064 0-.075-.006-.075.073v1.445c0 .083-.006.077.08.077h.854c.075 0 .07-.004.07.07v4.624c0 .095.008.084-.085.084-.37 0-1.11-.002-1.304 0-.048.001-.06.03-.06.03l-.697 1.519s-.014.025-.008.036c.006.01.013.008.058.008 1.748.003 3.495.002 5.243.002.03-.001.034-.006.035-.033v-1.539zm4.177-3.43c0 .013-.007.023-.02.024-.346.006-.692.004-1.037.004-.014-.002-.022-.01-.022-.024-.005-.434-.007-.869-.01-1.303 0-.072-.006-.071.07-.07l.733-.003c.041 0 .081.002.12.015.093.025.16.107.165.204.006.431.002 1.153.001 1.153zm2.67.244a1.953 1.953 0 0 0-.883-.222h-.18c-.04-.001-.04-.003-.042-.04V10.21c0-.132-.007-.263-.025-.394a1.823 1.823 0 0 0-.153-.53 1.533 1.533 0 0 0-.677-.71 2.167 2.167 0 0 0-1-.258c-.153-.003-.567 0-.72 0-.07 0-.068.004-.068-.065V7.76c0-.031-.01-.041-.046-.039H17.93s-.016 0-.023.007c-.006.006-.008.012-.008.023v.546c-.008.036-.057.015-.082.022h-.95c-.022.002-.028.008-.03.032v1.481c0 .09-.004.082.082.082h.913c.082 0 .072.128.072.128V11.19s.003.117-.06.117h-1.482c-.068 0-.06.082-.06.082v1.445s-.01.068.064.068h1.457c.082 0 .076-.006.076.079v3.225c0 .088-.007.081.082.081h1.43c.09 0 .082.007.082-.08v-3.27c0-.029.006-.035.033-.035l2.323-.003c.098 0 .191.02.28.061a.46.46 0 0 1 .274.407c.008.395.003.79.003 1.185 0 .259-.107.367-.33.367h-1.218c-.023.002-.029.008-.028.033.184.437.374.871.57 1.303a.045.045 0 0 0 .04.026c.17.005.34.002.51.003.15-.002.517.004.666-.01a2.03 2.03 0 0 0 .408-.075c.59-.18.975-.698.976-1.313v-1.981c0-.128-.01-.254-.034-.38 0 .078-.029-.641-.724-.998z"></path></svg> </a> </li>        </ul>  <p class="text-white/75">Copyright © 2025 a theme by <a href="https://themefisher.com">Themefisher</a></p> </div> </footer> </body></html>